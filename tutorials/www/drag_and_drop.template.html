<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to you under the Apache License,
Version 2.0 (the "License"); you may not use this file except in
compliance with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html>
<head>
<title>Drag and Drop</title>
<link rel="stylesheet" href="tutorial.css">
<script src="http://java.com/js/deployJava.js"></script>

<!-- NOTE: Syntax highlighting script is LGPL -->
<script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js"></script>
<script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJava.js"></script>
<script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js"></script>
<link type="text/css" rel="stylesheet" href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css"/>
<link type="text/css" rel="stylesheet" href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css"/>
<script type="text/javascript">
    SyntaxHighlighter.all();
</script>
<style>
td {
    text-align:center;
    vertical-align:top;
}
</style>
</head>
<body>
<h1>Drag and Drop</h1>

<p>Like the clipboard, drag and drop is a common metaphor for data transfer. By clicking and dragging with the mouse, the user can move, copy, or link data within or between applications.</p>

<p>The following application demonstrates Pivot's support for drag and drop. Users can drag the sample images from this page into the applet (the area within the border), or drag the image out of the applet into any other application that supports images:</p>

<table>
<tr>
<td rowspan="2">
<script>
var attributes = {code:"org.apache.pivot.wtk.BrowserApplicationContext$HostApplet",
    archive:"lib/@project_name@-core-@version@.signed.jar,lib/@project_name@-wtk-@version@.signed.jar,lib/@project_name@-wtk-@version@.terra.signed.jar,lib/@project_name@-tutorials-@version@.signed.jar",
    width:480,
    height:480
};
var parameters = {application_class_name:"org.apache.pivot.wtk.ScriptApplication",
    codebase_lookup:false,
    java_arguments:"-Dsun.awt.noerasebackground=true -Dsun.awt.erasebackgroundonresize=true",
    startup_properties:"org/apache/pivot/tutorials/dragdrop/drag_drop.wtkx"
};
deployJava.writeAppletTag(attributes, parameters);
</script>
</td>
<td><img src="IMG_0725_2.jpg"></td>
<tr>
<td><img src="IMG_0735_2.jpg"></td>
</tr>
</table>

<p>The WTKX source for this example is as follows. It creates an <tt>ImageView</tt> and attaches a drag source and drop target to it via the <tt>dragSource</tt> and <tt>dropTarget</tt> attributes, respectively. The code for these handlers is defined in "dragdrop.js", discussed next:</p>

<pre class="brush:xml">
&lt;Window title="Drag and Drop" maximized="true"
    xmlns:wtkx="http://pivot.apache.org/wtkx"
    xmlns="org.apache.pivot.wtk"&gt;
    &lt;wtkx:script src="dragdrop.js"/&gt;
    &lt;content&gt;
        &lt;Border&gt;
            &lt;content&gt;
                &lt;ImageView wtkx:id="imageView" image="org/apache/pivot/tutorials/IMG_0767_2.jpg"
                    dragSource="$dragSoure" dropTarget="$dropTarget"/&gt;
            &lt;/content&gt;
        &lt;/Border&gt;
    &lt;/content&gt;
&lt;/Window&gt;
</pre>

<p>The contents of "dragdrop.js" are as follows:</p>

<pre class="brush:javascript">
importPackage(org.apache.pivot.wtk);

var dragSoure = new DragSource() {
    beginDrag: function(component, x, y) {
        return true;
    },

    endDrag: function(component, dropAction) {
        // No-op
    },

    getContent: function() {
        var content = new LocalManifest();
        content.putImage(imageView.getImage());

        return content;
    },

    getOffset: function() {
        // No-op; not used for native drags
        return null;
    },

    getRepresentation: function() {
        // No-op; not used for native drags
        return null;
    },

    getSupportedDropActions: function() {
        return DropAction.COPY.getMask();
    },

    isNative: function() {
        return true;
    }
};

var dropTarget = new DropTarget() {
    dragEnter: function(component, dragContent, supportedDropActions, userDropAction) {
        return (dragContent.containsImage()) ? DropAction.COPY : null;
    },

    dragExit: function(component) {
        // No-op
    },

    dragMove: function(component, dragContent, supportedDropActions, x, y, userDropAction) {
        return (dragContent.containsImage()) ? DropAction.COPY : null;
    },

    userDropActionChange: function(component, dragContent, supportedDropActions,
        x, y, userDropAction) {
        return (dragContent.containsImage()) ? DropAction.COPY : null;
    },

    drop: function(component, dragContent, supportedDropActions, x, y, userDropAction) {
        var dropAction = null;

        if (dragContent.containsImage()) {
            imageView.setImage(dragContent.getImage());
            dropAction = DropAction.COPY;
        }

        return dropAction;
    }
};
</pre>

<p>When the user initiates a drag operation, the Pivot platform detects the gesture and walks the component hierarchy looking for a drag source. When it finds one, it calls <tt>beginDrag()</tt>. If this method returns <tt>true</tt>, the platform calls <tt>getContent()</tt> and begins the drag. Like the clipboard, drag/drop content is also stored in a <tt>Manifest</tt>. In the case of a drag source, a <tt>LocalManifest</tt> is used. The drag source in this example simply places the image that is currently displayed by the image view in the manifest. It also reports that the only supported action for this drag operation is COPY, by returning the bitmask value of <tt>DropAction.COPY</tt> from <tt>getSupportedDropActions()</tt>.</p>

<p>When the user drags an image over the image view, the platform walks the component hierarchy looking for a drop target. When it finds one, it calls <tt>dragEnter()</tt>. If the drop target is capable of accepting the drop, it returns its preferred drop action (the action that would result if the user dropped the drag content at that point). The platform repeatedly calls <tt>dragMove()</tt> while the mouse remains over the drop target, giving the application the opportunity to report a different drop action depending on the current mouse location.</p>

<p>Finally, when the user releases the mouse button, the <tt>drop()</tt> method is called. This method actually performs the drop, and returns the actual drop action that was performed (or <tt>null</tt> if nothing was dropped).</p>

<p>Next: <a href="drawing.html">Drawing</a></p>
</body>
</html>
