<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to you under the Apache License,
Version 2.0 (the "License"); you may not use this file except in
compliance with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<html>
<head>
<title>Localization</title>
<link rel="stylesheet" href="tutorial.css">
<script src="http://java.com/js/deployJava.js"></script>

<!-- NOTE: Syntax highlighting script is LGPL -->
<script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js"></script>
<script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJava.js"></script>
<script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js"></script>
<script type="text/javascript" src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js"></script>
<link type="text/css" rel="stylesheet" href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css"/>
<link type="text/css" rel="stylesheet" href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css"/>
<script type="text/javascript">
    SyntaxHighlighter.all();
</script>
</head>
<body>
<h1>Localization</h1>

<p>In Java, any translatable text is generally stored in a set of localized property files called "resource bundles". The appropriate file is loaded at runtime for either the default locale or an explicitly selected non-default locale. While it is possible to use standard Java resource bundles in a Pivot application, Pivot adds support for JSON-based resource bundles that are slightly more flexible the built-in properties-based bundles. JSON resource bundles allow developers to more easily work with UTF-8 encoded resource strings, and also natively support hierarchical data, which can only be simulated when using properties files.</p>

<p>The following application provides a simple demonstration of localization in Pivot:</p>

<script src="version.js"></script>
<script>
var attributes = {code:"org.apache.pivot.wtk.BrowserApplicationContext$HostApplet",
    archive:"lib/pivot-core-" + version + ".jar"
        + ",lib/pivot-wtk-" + version + ".jar"
        + ",lib/pivot-wtk-" + version + ".terra.jar"
        + ",lib/pivot-tutorials-" + version + ".jar",
    width:320,
    height:240
};
var parameters = {application_class_name:"org.apache.pivot.tutorials.localization.Localization",
    codebase_lookup:false,
    java_arguments:"-Dsun.awt.noerasebackground=true -Dsun.awt.erasebackgroundonresize=true"
};
deployJava.writeAppletTag(attributes, parameters);
</script>

<p>The following resource bundles are provided; if your default system locale is among these, you should see a localized version of the application. Otherwise, the default locale ("en") will be used:</p>

<ul>
<li>Localization.json</li>
<li>Localization_cn.json</li>
<li>Localization_de.json</li>
<li>Localization_it.json</li>
<li>Localization_ph.json</li>
</ul>

<p>The resource bundle for the default locale is shown below:</p>

<pre class="brush:jscript">
{   firstName: "First name",
    lastName: "Last name",
    street: "Street",
    city: "City",
    state: "State",
    postalCode: "Zip",
    country: "Country"
}
</pre>

<p>The WTKX source for the application is as follows. Note the use of the "%" prefix in the form label attributes. This prefix is known as the "resource resolution operator" in WTKX. As the WTKX is read, attribute values that begin with the "%" character are replaced by the corresponding values defined in the resource bundle:</p>

<pre class="brush:xml">
&lt;Window title="Localization" maximized="true"
    xmlns:wtkx="http://pivot.apache.org/wtkx"
    xmlns="org.apache.pivot.wtk"&gt;
    &lt;windowStateListeners&gt;
        &lt;wtkx:script&gt;
        &lt;![CDATA[
        function windowOpened(window) {
            window.requestFocus();
        }
        ]]&gt;
        &lt;/wtkx:script&gt;
    &lt;/windowStateListeners&gt;

    &lt;content&gt;
        &lt;Border styles="{padding:6}"&gt;
            &lt;content&gt;
                &lt;Form&gt;
                    &lt;sections&gt;
                        &lt;Form.Section&gt;
                            &lt;TextInput Form.label="%firstName"/&gt;
                            &lt;TextInput Form.label="%lastName"/&gt;
                            &lt;TextInput Form.label="%street"/&gt;
                            &lt;TextInput Form.label="%city"/&gt;
                            &lt;TextInput Form.label="%state" textSize="4"/&gt;
                            &lt;TextInput Form.label="%postalCode"/&gt;
                            &lt;TextInput Form.label="%country"/&gt;
                        &lt;/Form.Section&gt;
                    &lt;/sections&gt;
                &lt;/Form&gt;
            &lt;/content&gt;
        &lt;/Border&gt;
    &lt;/content&gt;
&lt;/Window&gt;
</pre>

<p>The Java source for the application is shown below:</p>

<pre class="brush:java">
package org.apache.pivot.tutorials.localization;

import java.awt.Font;
import java.awt.GraphicsEnvironment;
import java.util.Locale;

import org.apache.pivot.collections.Map;
import org.apache.pivot.util.Resources;
import org.apache.pivot.wtk.Application;
import org.apache.pivot.wtk.DesktopApplicationContext;
import org.apache.pivot.wtk.Display;
import org.apache.pivot.wtk.Theme;
import org.apache.pivot.wtk.Window;
import org.apache.pivot.wtkx.WTKXSerializer;

public class Localization implements Application {
    private Window window = null;

    public static final String LANGUAGE_KEY = "language";

    @Override
    public void startup(Display display, Map&lt;String, String&gt; properties) throws Exception {
        String language = properties.get(LANGUAGE_KEY);
        if (language != null) {
            Locale.setDefault(new Locale(language));
        }

        Resources resources = new Resources(getClass().getName(), "UTF-8");

        Theme theme = Theme.getTheme();
        Font font = theme.getFont();

        // Search for a font that can support the sample string
        String sampleResource = resources.getString("firstName");
        if (font.canDisplayUpTo(sampleResource) != -1) {
            Font[] fonts = GraphicsEnvironment.getLocalGraphicsEnvironment().getAllFonts();

            for (int i = 0; i &lt; fonts.length; i++) {
                if (fonts[i].canDisplayUpTo(sampleResource) == -1) {
                    theme.setFont(fonts[i].deriveFont(Font.PLAIN, 12));
                    break;
                }
            }
        }

        WTKXSerializer wtkxSerializer = new WTKXSerializer(resources);

        window = (Window)wtkxSerializer.readObject(this, "localization.wtkx");
        window.open(display);
    }

    @Override
    public boolean shutdown(boolean optional) {
        if (window != null) {
            window.close();
        }

        return false;
    }

    @Override
    public void suspend() {
    }

    @Override
    public void resume() {
    }

    public static void main(String[] args) {
        DesktopApplicationContext.main(Localization.class, args);
    }
}
</pre>

<p>Note that the application accepts a startup property named "language" to allow a caller to override the default locale. The following example shows the application loaded with "language" value of "de" (the applet is signed to allow the code to set the locale):</p>

<script src="version.js"></script>
<script>
var attributes = {code:"org.apache.pivot.wtk.BrowserApplicationContext$HostApplet",
    archive:"lib/pivot-core-" + version + ".signed.jar"
        + ",lib/pivot-wtk-" + version + ".signed.jar"
        + ",lib/pivot-wtk-" + version + ".terra.signed.jar"
        + ",lib/pivot-tutorials-" + version + ".signed.jar",
    width:320,
    height:240
};
var parameters = {application_class_name:"org.apache.pivot.tutorials.localization.Localization",
    codebase_lookup:false,
    java_arguments:"-Dsun.awt.noerasebackground=true -Dsun.awt.erasebackgroundonresize=true",
    startup_properties:"language=de"
};
deployJava.writeAppletTag(attributes, parameters);
</script>

<p>Notice that the <tt>startup()</tt> method includes code to search for a font that can display a sample set of characters obtained from the "firstName" resource. This is because all fonts are not guaranteed to include support for all possible Unicode characters. If the current theme font is not capable of displaying the sample string, this block of code attempts to identify and set one that can. This code must be executed prior to constructing any user interface elements so that the correct font will be used.</p>

<p>Next: <a href="scripting.html">Scripting</a></p>
</html>
