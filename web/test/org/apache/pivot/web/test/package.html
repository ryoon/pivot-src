<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to you under the Apache License,
Version 2.0 (the "License"); you may not use this file except in
compliance with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
</head>
<body>
<p>Provides classes for Testing HTTP communication classes.</p>

<p>
Note that the classes <b>WebQueryTestClientBasic</b> and <b>WebQueryTestClientDigest</b> works under JUnit 4, 
but more than Unit Tests they are <u>Integration Tests</u>, because they require a working HTTP Server
setup in the right way for their test to be successfully run.<br/>
So they should be <u>excluded</u> from usual (Unit) Test Suite (run for example during Release builds).
</p>

<p>
The following instructions explains the setup required for the right execution of 
WebQueryTestClientBasic and WebQueryTestClientDigest Integration Tests with JUnit 4.
</p>
<br/>

<p><b>Requirements:</b><br/></p>
<ul>
<li>Apache 2.2.x Web Server installed and working on localhost</li>
<li>JUnit 4.x Test Runner, like that inside Eclipse</li>
<li>(optional) Apache Tomcat 6.0.x installed and working on localhost</li>
</ul>


<p><b>Test Setup for Apache:</b></p>
<ul>
<li>
in the main Apache configuration file (APACHE_HOME/conf/httpd.conf) make some modify:<br/>
enable the digest authentication module, removing the comment on it, for example:
<pre>
# LoadModule auth_digest_module modules/mod_auth_digest.so
LoadModule auth_digest_module modules/mod_auth_digest.so
</pre>
Note that the module for the Basic Authentication (needed by the other class WebQueryTestClientBasic), by default is already enabled in Apache.<br/>
<br/>
Then, enable the usage of .htaccess files on the root folder (by default htdocs), for a simpler per-directory authentication and authorization setup:
<pre>
#     AllowOverride None
    AllowOverride All
or
    AllowOverride AuthConfig    
</pre>
Note that this is only a convenience setting, targeted at these tests.
<br/>
</li>
<li>test that Apache works, starting/restarting it, to ensure the configuration is right
<br/>
</li>
<li>go into the published directory (htdocs, or public_html, depending on the environment) and create the following empty directories: 
public (optional), protected (for testing basic authentication), protected_digest (for testing digest authentication), dir (for testing digest authentication, using the same values from the RFC)
<br/>
Copy some files (for example one binary like test.jpg, and one of text like test.txt) inside any of the previously-created directories.
In the dir directory, put a index.html file (required by the test, because all tests as explained in the RFC use it).
<br/>
</li>
<li>in the "dir" directory, create a (text) file named .htaccess , and put inside this:
<pre>
AuthType Digest

# Note that with Digest Authentication, the value of AuthName must be the same as the realm
AuthName "testrealm@host.com"

AuthDigestDomain /dir/ 
AuthUserFile  "htdocs/dir/.htpasswd"
Require valid-user

# Hack for enabling pre IE 7 to work good with Digest Authentication
BrowserMatch "MSIE" AuthDigestEnableQueryStringHack=On
</pre>
<br/>
</li>
<li>in the "protected" dir (required by Basic Test), create a (text) file named .htaccess , and put inside this:
<pre>
AuthType Basic
AuthName "Password Required"

AuthUserFile  "htdocs/protected/.htpasswd"
Require valid-user
</pre>
<br/>
</li>
<li>in the "protected_digest" dir, create a (text) file named .htaccess , and put inside this:
<pre>
AuthType Digest

# Note that with Digest Authentication, the value of AuthName must be the same as the realm
AuthName "Password Required (Digest)"

AuthDigestDomain /protected_digest/ 
AuthUserFile  "htdocs/protected_digest/.htpasswd"
Require valid-user

# Hack for enabling pre IE 7 to work good with Digest Authentication
BrowserMatch "MSIE" AuthDigestEnableQueryStringHack=On
</pre>
<br/>
</li>
<li>from the prompt, use some standard Apache commands to create the digested passwords.
If Apache commands are available in PATH, go directly in the target directory, 
otherwise for example you'll have to go to the main apache directory and launch them using for example bin\ht*.exe (for Windows), 
and then move the generated file into the right directory.
<pre>
Optional, for the "protected" (Basic Authentication) for example use:
htpasswd -c .htpasswd test
htpasswd will ask you for the password (in this case "test0", but without quotes), and then ask you to type it again to confirm it

For the "protected_digest" (Digest Authentication) for example use:
htdigest -c .htpasswd "Password Required (Digest)" test
htdigest will ask you for the password (in this case "test0", but without quotes), and then ask you to type it again to confirm it
<br/>
For the "dir" (Digest Authentication) for example use:
htdigest -c .htpasswd "testrealm@host.com" Mufasa
htdigest will ask you for the password (in this case "Circle Of Life", but without quotes), and then ask you to type it again to confirm it
</pre>
<br/>
</li>
<li>manual test using a browser (to ensure the directories has been protected in the right way): 
point to the URL http://localhost/ , and then add (by hand) the subdirectory names, and try to access.
Note that all protected directories are not visible from here.
Any time required, the browser will open an Authentication popup, where to put username/password data (always without quotes).
<br/>
<pre>
"protected/" needs username "test" and password "test0"
"protected_digest/" needs username "test" and password "test0"
"dir/" needs username "Mufasa" and password "Circle Of Life"
</pre>
<br/>
</li>
<li>execute the Test class, for example by running it from Eclipse (or by prompt), using JUnit 4, and see results.
<br/>
</li>
</ul>

<br/>


<p><b>Test Setup for Tomcat:</b><p/>
<ul>
<li>under Tomcat things are different: first is needed a webapp, for example pivot-test
</li>
<li>
then, configure the security (but of the full webapp) as BASIC or DIGEST, so it will be possible only one type of Integration Tests per run 
(or two different webapps could be used, like pivot-test-basic and pivot-test-digest)
</li>
<li>
under the Tomcat Users file define the following (in the right XML format, inside the file):
<pre>
role rolename="test" 
user username="test" password="test0" roles="test"  
user username="Mufasa" password="Circle Of Life" roles="test"  
</pre>
and then Restart Tomcat (important)
<br/>
Note that this is enough for BASIC authentication, while for DIGEST passwords must be written here in encoded format (digest), 
see the Tomcat docs for more detail on this.
<br/>
</li>
<li>
as with Apache, do a 
manual test using a browser (to ensure the directories has been protected in the right way and are accessible): 
point to the URL http://localhost:8080/pivot-test/ , and then add (by hand) the subdirectory names, and try to access. 
Note that all protected directories are not visible from here. 
Any time required, the browser will open an Authentication popup, where to put username/password data (always without quotes). 
</li>
<li>
change json data inside config files for Tests (any test has its own config) file that by default here works with Apache,
so to make it work with Tomcat at least you'll have to comment the two lines defining the port and the webapp, 
and uncomment the two for Tomcat.
</li>
<li>
suggestion: start running the BASIC authentication test, and only after the DIGEST.
</li>
<li>execute the Test class, for example by running it from Eclipse (or by prompt), using JUnit 4, and see results.
<br/>
</li>
</ul>


<br/>

</body>
</html>
